<Window x:Class="PortProxyClient.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:PortProxyClient.Models"
        Title="Port Proxy Client" Height="700" Width="1100"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource BackgroundBrush}"
        WindowStyle="None"
        AllowsTransparency="True"
        ResizeMode="CanResizeWithGrip">
    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="0" 
                      ResizeBorderThickness="5" 
                      CornerRadius="0"
                      GlassFrameThickness="0"/>
    </WindowChrome.WindowChrome>
    
    <Window.Resources>
        <!-- Icon Paths -->
        <Geometry x:Key="AddIcon">M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z</Geometry>
        <Geometry x:Key="EditIcon">M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z</Geometry>
        <Geometry x:Key="DeleteIcon">M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z</Geometry>
        <Geometry x:Key="RefreshIcon">M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z</Geometry>
        <Geometry x:Key="ImportIcon">M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z</Geometry>
        <Geometry x:Key="ExportIcon">M9,16V10H5L12,3L19,10H15V16H9M5,20V18H19V20H5Z</Geometry>
        <Geometry x:Key="NetworkIcon">M12,2C6.48,2 2,6.48 2,12C2,17.52 6.48,22 12,22C17.52,22 22,17.52 22,12C22,6.48 17.52,2 12,2M11,19.93C7.05,19.44 4,16.08 4,12C4,11.38 4.08,10.78 4.21,10.21L9,15V16C9,17.1 9.9,18 11,18M17.9,17.39C17.64,16.58 16.9,16 16,16H15V13C15,12.45 14.55,12 14,12H8V10H10C10.55,10 11,9.55 11,9V7H13C14.1,7 15,6.1 15,5V4.59C17.93,5.78 20,8.65 20,12C20,14.08 19.2,15.97 17.9,17.39Z</Geometry>
        <Geometry x:Key="ServerIcon">M4,1H20A1,1 0 0,1 21,2V6A1,1 0 0,1 20,7H4A1,1 0 0,1 3,6V2A1,1 0 0,1 4,1M4,9H20A1,1 0 0,1 21,10V14A1,1 0 0,1 20,15H4A1,1 0 0,1 3,14V10A1,1 0 0,1 4,9M4,17H20A1,1 0 0,1 21,18V22A1,1 0 0,1 20,23H4A1,1 0 0,1 3,22V18A1,1 0 0,1 4,17M5,2V6H19V2H5M5,10V14H19V10H5M5,18V22H19V18H5Z</Geometry>
        <Geometry x:Key="SiloIcon">M12,2L13.09,8.26L22,9L13.09,9.74L12,16L10.91,9.74L2,9L10.91,8.26L12,2M12,21.5C12.83,21.5 13.5,22.17 13.5,23C13.5,23.83 12.83,24.5 12,24.5C11.17,24.5 10.5,23.83 10.5,23C10.5,22.17 11.17,21.5 12,21.5Z</Geometry>
        <Geometry x:Key="SettingsIcon">M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.22,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.22,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.68 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z</Geometry>
        
        <!-- Converters -->
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <Geometry x:Key="MinimizeIcon">M19,13H5V11H19V13Z</Geometry>
        <Geometry x:Key="MaximizeIcon">M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3M19,5V19H5V5H19Z</Geometry>
        <Geometry x:Key="RestoreIcon">M4,8H8V4H20V16H16V20H4V8M16,8V14H18V6H10V8H16M6,12V18H14V12H6Z</Geometry>
        <Geometry x:Key="CloseIcon">M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z</Geometry>
    </Window.Resources>
    
    <Border BorderBrush="{StaticResource BorderBrush}" BorderThickness="1" Background="{StaticResource BackgroundBrush}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Custom Title Bar -->
            <Border Grid.Row="0" Background="{StaticResource SurfaceBrush}" 
                    MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid Height="32">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- App Icon and Title -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="12,0">
                        <Path Data="{StaticResource NetworkIcon}" 
                              Fill="{StaticResource PrimaryBrush}" 
                              Width="16" Height="16" 
                              Stretch="Uniform" 
                              VerticalAlignment="Center"
                              Margin="0,0,8,0"/>
                        <TextBlock Text="Port Forward Manager" 
                                   FontSize="12"
                                   VerticalAlignment="Center"
                                   Foreground="{StaticResource TextPrimaryBrush}"/>
                    </StackPanel>
                    
                    <!-- Window Controls -->
                    <StackPanel Grid.Column="2" Orientation="Horizontal">
                        <Button Style="{StaticResource IconButton}" 
                                Width="46" Height="32"
                                Click="MinimizeButton_Click"
                                WindowChrome.IsHitTestVisibleInChrome="True">
                            <Path Data="{StaticResource MinimizeIcon}" 
                                  Fill="{StaticResource TextSecondaryBrush}" 
                                  Width="16" Height="16" 
                                  Stretch="Uniform"/>
                        </Button>
                        <Button Style="{StaticResource IconButton}" 
                                Width="46" Height="32"
                                Click="MaximizeButton_Click"
                                WindowChrome.IsHitTestVisibleInChrome="True">
                            <Path Data="{StaticResource MaximizeIcon}" 
                                  Fill="{StaticResource TextSecondaryBrush}" 
                                  Width="16" Height="16" 
                                  Stretch="Uniform"
                                  Name="MaximizeIcon"/>
                        </Button>
                        <Button Width="46" Height="32"
                                Click="CloseButton_Click"
                                WindowChrome.IsHitTestVisibleInChrome="True">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource IconButton}">
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="{StaticResource ErrorBrush}"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                            <Path Data="{StaticResource CloseIcon}" 
                                  Fill="{StaticResource TextSecondaryBrush}" 
                                  Width="16" Height="16" 
                                  Stretch="Uniform"/>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Modern Header with Integrated Actions -->
            <Border Grid.Row="1" Background="{StaticResource SurfaceBrush}" 
                    BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1">
                <Grid Margin="24,16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- Title Section -->
                <StackPanel Grid.Column="0" VerticalAlignment="Center">
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                        <Path Data="{StaticResource NetworkIcon}" 
                              Fill="{StaticResource PrimaryBrush}" 
                              Width="28" Height="28" 
                              Stretch="Uniform" 
                              VerticalAlignment="Center"
                              Margin="0,0,12,0"/>
                        <TextBlock Text="Port Forward Manager" 
                                   Style="{StaticResource TitleText}"/>
                    </StackPanel>
                    <TextBlock 
                               Style="{StaticResource SubtitleText}"
                               Margin="40,0,0,0"/>
                </StackPanel>

                <!-- Action Buttons -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                    <Button Style="{StaticResource ModernButton}" 
                            Click="AddRule_Click" 
                            Margin="0,0,8,0"
                            ToolTip="Add new port forwarding rule">
                        <StackPanel Orientation="Horizontal">
                            <Path Data="{StaticResource AddIcon}" 
                                  Fill="White" 
                                  Width="18" Height="18" 
                                  Stretch="Uniform" 
                                  Margin="0,0,8,0"/>
                            <TextBlock Text="Add Rule" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    
                    <Button Style="{StaticResource SecondaryButton}" 
                            Command="{Binding ManageServersCommand}"
                            Margin="0,0,8,0"
                            ToolTip="Manage servers and silos">
                        <StackPanel Orientation="Horizontal">
                            <Path Data="{StaticResource SettingsIcon}" 
                                  Fill="{StaticResource PrimaryBrush}" 
                                  Width="18" Height="18" 
                                  Stretch="Uniform" 
                                  Margin="0,0,8,0"/>
                            <TextBlock Text="Manage Servers" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    
                    <Button Style="{StaticResource SecondaryButton}" 
                            Click="ImportRules_Click" 
                            Margin="0,0,8,0"
                            ToolTip="Import rules from JSON file">
                        <StackPanel Orientation="Horizontal">
                            <Path Data="{StaticResource ImportIcon}" 
                                  Fill="{StaticResource PrimaryBrush}" 
                                  Width="18" Height="18" 
                                  Stretch="Uniform" 
                                  Margin="0,0,8,0"/>
                            <TextBlock Text="Import" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    
                    <Button Style="{StaticResource SecondaryButton}" 
                            Click="ExportRules_Click"
                            ToolTip="Export rules to JSON file">
                        <StackPanel Orientation="Horizontal">
                            <Path Data="{StaticResource ExportIcon}" 
                                  Fill="{StaticResource PrimaryBrush}" 
                                  Width="18" Height="18" 
                                  Stretch="Uniform" 
                                  Margin="0,0,8,0"/>
                            <TextBlock Text="Export" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
                </Grid>
            </Border>

            <!-- Main Content Area -->
            <Grid Grid.Row="2" Margin="24">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="300"/>
                    <ColumnDefinition Width="16"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <!-- Server Tree View -->
                <Border Grid.Column="0" Style="{StaticResource Card}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        
                        <Border Grid.Row="0" 
                                Background="{StaticResource SurfaceBrush}"
                                CornerRadius="6,6,0,0"
                                Padding="16,12">
                            <StackPanel Orientation="Horizontal">
                                <Path Data="{StaticResource ServerIcon}" 
                                      Fill="{StaticResource PrimaryBrush}" 
                                      Width="16" Height="16" 
                                      Stretch="Uniform" 
                                      Margin="0,0,8,0"/>
                                <TextBlock Text="SERVERS &amp; SILOS" 
                                           FontSize="12" 
                                           FontWeight="SemiBold" 
                                           Foreground="{StaticResource TextSecondaryBrush}"/>
                            </StackPanel>
                        </Border>
                        
                        <TreeView Grid.Row="1" 
                                  Background="Transparent"
                                  BorderThickness="0"
                                  Margin="8"
                                  SelectedItemChanged="TreeView_SelectedItemChanged"
                                  MouseDoubleClick="TreeView_MouseDoubleClick">
                            <TreeView.Resources>
                                <HierarchicalDataTemplate DataType="{x:Type local:Silo}" 
                                                          ItemsSource="{Binding AgentServers}">
                                    <StackPanel Orientation="Horizontal" 
                                                Margin="0,4">
                                        <Path Data="{StaticResource SiloIcon}" 
                                              Fill="{Binding RoleColor}" 
                                              Width="14" Height="14" 
                                              Stretch="Uniform" 
                                              Margin="0,0,8,0"/>
                                        <TextBlock Text="{Binding Name}" 
                                                   FontWeight="Medium"
                                                   Foreground="{StaticResource TextPrimaryBrush}"/>
                                        <Border Background="{Binding RoleColor}"
                                                CornerRadius="6"
                                                Padding="4,1"
                                                Margin="8,0,0,0">
                                            <TextBlock Text="{Binding RoleText}" 
                                                       FontSize="9"
                                                       FontWeight="SemiBold"
                                                       Foreground="White"/>
                                        </Border>
                                    </StackPanel>
                                </HierarchicalDataTemplate>
                                
                                <DataTemplate DataType="{x:Type local:AgentServer}">
                                    <StackPanel Orientation="Horizontal" 
                                                Margin="0,2">
                                        <Ellipse Width="8" Height="8" 
                                                 Fill="{Binding StatusColor}"
                                                 Margin="0,0,8,0"/>
                                        <TextBlock Text="{Binding Name}" 
                                                   FontWeight="Medium"
                                                   Foreground="{StaticResource TextPrimaryBrush}"/>
                                        <TextBlock Text="{Binding StatusText}" 
                                                   FontSize="10"
                                                   Foreground="{StaticResource TextSecondaryBrush}"
                                                   Margin="8,0,0,0"/>
                                    </StackPanel>
                                </DataTemplate>
                                
                            </TreeView.Resources>
                            
                            <TreeView.ItemsSource>
                                <Binding Path="Silos"/>
                            </TreeView.ItemsSource>
                        </TreeView>
                        
                        <!-- Failover Status Panel -->
                        <Border Grid.Row="2" 
                                Background="{StaticResource SurfaceBrush}"
                                BorderBrush="{StaticResource BorderBrush}"
                                BorderThickness="0,1,0,0"
                                Padding="16,12"
                                Visibility="{Binding HasSelectedTreeViewServer, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                    <Path Data="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4M11,16.5L6.5,12L7.91,10.59L11,13.67L16.59,8.09L18,9.5L11,16.5Z" 
                                          Fill="{StaticResource PrimaryBrush}" 
                                          Width="14" Height="14" 
                                          Stretch="Uniform" 
                                          Margin="0,0,8,0"/>
                                    <TextBlock Text="FAILOVER STATUS" 
                                               FontSize="11" 
                                               FontWeight="SemiBold" 
                                               Foreground="{StaticResource TextSecondaryBrush}"/>
                                </StackPanel>
                                
                                <Grid Margin="0,4,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    
                                    <TextBlock Grid.Row="0" Grid.Column="0" 
                                               Text="Status:" 
                                               FontSize="11" 
                                               Foreground="{StaticResource TextSecondaryBrush}"
                                               Margin="0,0,8,2"/>
                                    <TextBlock Grid.Row="0" Grid.Column="1" 
                                               Text="{Binding SelectedAgentFailoverStatus.StatusText}" 
                                               FontSize="11" 
                                               FontWeight="Medium"
                                               Foreground="{StaticResource TextPrimaryBrush}"
                                               Margin="0,0,0,2"/>
                                    
                                    <TextBlock Grid.Row="1" Grid.Column="0" 
                                               Text="Health:" 
                                               FontSize="11" 
                                               Foreground="{StaticResource TextSecondaryBrush}"
                                               Margin="0,0,8,2"/>
                                    <TextBlock Grid.Row="1" Grid.Column="1" 
                                               Text="{Binding SelectedAgentFailoverStatus.HealthSummary}" 
                                               FontSize="11" 
                                               Foreground="{StaticResource TextPrimaryBrush}"
                                               Margin="0,0,0,2"/>
                                    
                                    <TextBlock Grid.Row="2" Grid.Column="0" 
                                               Text="Last Check:" 
                                               FontSize="11" 
                                               Foreground="{StaticResource TextSecondaryBrush}"
                                               Margin="0,0,8,0"/>
                                    <TextBlock Grid.Row="2" Grid.Column="1" 
                                               Text="{Binding SelectedAgentFailoverStatus.LastCheckText}" 
                                               FontSize="11" 
                                               Foreground="{StaticResource TextPrimaryBrush}"/>
                                </Grid>
                            </StackPanel>
                        </Border>
                    </Grid>
                </Border>
                
                <!-- Rules Section -->
                <Grid Grid.Column="2">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Quick Actions Bar -->
                    <Border Grid.Row="0" Margin="0,0,0,16">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <!-- Rule Actions -->
                            <StackPanel Grid.Column="0" Orientation="Horizontal">
                                <Button Style="{StaticResource IconButton}" 
                                        Click="EditRule_Click" 
                                        IsEnabled="{Binding HasSelectedRule}"
                                        ToolTip="Edit selected rule"
                                        Margin="0,0,8,0">
                                    <Path Data="{StaticResource EditIcon}" 
                                          Fill="{StaticResource TextSecondaryBrush}" 
                                          Width="20" Height="20" 
                                          Stretch="Uniform"/>
                                </Button>
                                
                                <Button Style="{StaticResource IconButton}" 
                                        Click="DeleteRule_Click" 
                                        IsEnabled="{Binding HasSelectedRule}"
                                        ToolTip="Delete selected rule"
                                        Margin="0,0,8,0">
                                    <Path Data="{StaticResource DeleteIcon}" 
                                          Fill="{StaticResource ErrorBrush}" 
                                          Width="20" Height="20" 
                                          Stretch="Uniform"/>
                                </Button>
                                
                                <Rectangle Width="1" Height="24" Fill="{StaticResource BorderBrush}" Margin="8,0"/>
                                
                                <Button Style="{StaticResource IconButton}" 
                                        Click="Refresh_Click"
                                        ToolTip="Refresh rules list">
                                    <Path Data="{StaticResource RefreshIcon}" 
                                          Fill="{StaticResource TextSecondaryBrush}" 
                                          Width="20" Height="20" 
                                          Stretch="Uniform"/>
                                </Button>
                            </StackPanel>
                            
                            <!-- Rule Count -->
                            <TextBlock Grid.Column="1" 
                                       Text="{Binding RuleCountText}" 
                                       Style="{StaticResource SubtitleText}"
                                       VerticalAlignment="Center"/>
                        </Grid>
                    </Border>

                    <!-- Data Grid Card -->
                    <Border Grid.Row="1" Style="{StaticResource Card}">
                        <Grid>
                            <!-- Rules DataGrid -->
                            <DataGrid Name="RulesDataGrid" 
                                      Style="{StaticResource ModernDataGrid}"
                                      ItemsSource="{Binding FilteredRules}"
                                      SelectedItem="{Binding SelectedRule}"
                                      ColumnHeaderStyle="{StaticResource ModernDataGridColumnHeader}"
                                      RowStyle="{StaticResource ModernDataGridRow}"
                                      Visibility="{Binding HasSelectedTreeViewServer, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <DataGrid.Resources>
                                <Style TargetType="DataGridCell">
                                    <Setter Property="BorderThickness" Value="0"/>
                                    <Setter Property="Padding" Value="16,0"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="DataGridCell">
                                                <Border Padding="{TemplateBinding Padding}" 
                                                        Background="{TemplateBinding Background}">
                                                    <ContentPresenter VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter Property="Background" Value="Transparent"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </DataGrid.Resources>
                            
                            <DataGrid.Columns>
                                <DataGridTemplateColumn Header="DESCRIPTION" Width="200">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel VerticalAlignment="Center">
                                                <TextBlock Text="{Binding Description}" 
                                                           FontWeight="Medium" 
                                                           Foreground="{StaticResource TextPrimaryBrush}"
                                                           TextTrimming="CharacterEllipsis"/>
                                                <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                                                    <Border Background="{Binding CategoryBadgeColor}" 
                                                            CornerRadius="8" 
                                                            Padding="6,1"
                                                            Margin="0,0,4,0">
                                                        <Border.Style>
                                                            <Style TargetType="Border">
                                                                <Setter Property="Visibility" Value="Visible"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding Category}" Value="">
                                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding Category}" Value="{x:Null}">
                                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Border.Style>
                                                        <TextBlock Text="{Binding Category}" 
                                                                   FontSize="9" 
                                                                   FontWeight="SemiBold"
                                                                   Foreground="White"/>
                                                    </Border>
                                                    <TextBlock Text="{Binding TagsText}" 
                                                               FontSize="10" 
                                                               Foreground="{StaticResource TextSecondaryBrush}"
                                                               TextTrimming="CharacterEllipsis"
                                                               MaxWidth="100"/>
                                                </StackPanel>
                                            </StackPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                
                                <DataGridTemplateColumn Header="LISTEN" Width="140">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel VerticalAlignment="Center">
                                                <TextBlock Text="{Binding ListenAddress}" 
                                                           FontWeight="Medium" 
                                                           Foreground="{StaticResource TextPrimaryBrush}"/>
                                                <TextBlock FontSize="12" 
                                                           Foreground="{StaticResource TextSecondaryBrush}">
                                                    <TextBlock.Text>
                                                        <MultiBinding StringFormat="Port {0}">
                                                            <Binding Path="ListenPort"/>
                                                        </MultiBinding>
                                                    </TextBlock.Text>
                                                </TextBlock>
                                            </StackPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                
                                <DataGridTemplateColumn Header="FORWARD TO" Width="140">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel VerticalAlignment="Center">
                                                <TextBlock Text="{Binding DisplayAddress}" 
                                                           FontWeight="Medium" 
                                                           Foreground="{StaticResource TextPrimaryBrush}"
                                                           TextTrimming="CharacterEllipsis"/>
                                                <TextBlock FontSize="12" 
                                                           Foreground="{StaticResource TextSecondaryBrush}">
                                                    <TextBlock.Text>
                                                        <MultiBinding StringFormat="Port {0}">
                                                            <Binding Path="ForwardPort"/>
                                                        </MultiBinding>
                                                    </TextBlock.Text>
                                                </TextBlock>
                                            </StackPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                
                                <DataGridTemplateColumn Header="AGENT" Width="130">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel VerticalAlignment="Center">
                                                <TextBlock Text="{Binding AgentServerName}" 
                                                           FontWeight="Medium" 
                                                           Foreground="{StaticResource TextPrimaryBrush}"
                                                           TextTrimming="CharacterEllipsis"/>
                                                <TextBlock Text="Executes command" 
                                                           FontSize="10" 
                                                           Foreground="{StaticResource TextSecondaryBrush}"
                                                           FontStyle="Italic"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                
                                <DataGridTemplateColumn Header="TARGET" Width="130">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel VerticalAlignment="Center">
                                                <TextBlock Text="{Binding TargetServerName}" 
                                                           FontWeight="Medium" 
                                                           Foreground="{StaticResource TextPrimaryBrush}"
                                                           TextTrimming="CharacterEllipsis"/>
                                                <TextBlock Text="Traffic destination" 
                                                           FontSize="10" 
                                                           Foreground="{StaticResource TextSecondaryBrush}"
                                                           FontStyle="Italic"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                
                                <DataGridTemplateColumn Header="PROTOCOL" Width="80">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Background="#E8EAF6" 
                                                    CornerRadius="12" 
                                                    Padding="6,2"
                                                    HorizontalAlignment="Left">
                                                <TextBlock Text="{Binding ProtocolString}" 
                                                           FontSize="10" 
                                                           FontWeight="Medium"
                                                           Foreground="{StaticResource PrimaryBrush}"/>
                                            </Border>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                
                                <DataGridTemplateColumn Header="" Width="*">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <!-- Empty column to fill remaining space -->
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                            
                            <!-- Empty State Message -->
                            <StackPanel VerticalAlignment="Center" 
                                        HorizontalAlignment="Center">
                                <StackPanel.Style>
                                    <Style TargetType="StackPanel">
                                        <Setter Property="Visibility" Value="Visible"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding HasSelectedTreeViewServer}" Value="True">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </StackPanel.Style>
                                
                                <Path Data="{StaticResource ServerIcon}" 
                                      Fill="{StaticResource TextSecondaryBrush}" 
                                      Width="48" Height="48" 
                                      Stretch="Uniform" 
                                      HorizontalAlignment="Center"
                                      Margin="0,0,0,16"/>
                                      
                                <TextBlock Text="Select a Server" 
                                           FontSize="18" 
                                           FontWeight="Medium"
                                           Foreground="{StaticResource TextPrimaryBrush}"
                                           HorizontalAlignment="Center"
                                           Margin="0,0,0,8"/>
                                           
                                <TextBlock Text="Choose a server from the left panel to view its port forwarding rules" 
                                           FontSize="14" 
                                           Foreground="{StaticResource TextSecondaryBrush}"
                                           HorizontalAlignment="Center"
                                           TextWrapping="Wrap"
                                           MaxWidth="300"
                                           TextAlignment="Center"/>
                            </StackPanel>
                        </Grid>
                    </Border>
                </Grid>
            </Grid>

            <!-- Modern Status Bar -->
            <Border Grid.Row="3" 
                Background="{StaticResource SurfaceBrush}" 
                BorderBrush="{StaticResource BorderBrush}" 
                BorderThickness="0,1,0,0">
            <Grid Margin="24,12">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock Grid.Column="0" 
                           Text="{Binding StatusText}" 
                           Foreground="{StaticResource TextSecondaryBrush}"
                           VerticalAlignment="Center"/>
                
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <TextBlock Text="Administrator" 
                               Foreground="{StaticResource SuccessBrush}" 
                               FontWeight="Medium"
                               Margin="0,0,16,0"/>
                    <TextBlock Text="•" 
                               Foreground="{StaticResource BorderBrush}" 
                               Margin="0,0,16,0"/>
                    <TextBlock Text="Windows Port Proxy Service" 
                               Foreground="{StaticResource TextSecondaryBrush}"/>
                </StackPanel>
            </Grid>
            </Border>
        </Grid>
    </Border>

    <!-- Menu for advanced operations (hidden by default) -->
    <Window.InputBindings>
        <KeyBinding Key="N" Modifiers="Ctrl" Command="{Binding AddRuleCommand}"/>
        <KeyBinding Key="E" Modifiers="Ctrl" Command="{Binding EditRuleCommand}"/>
        <KeyBinding Key="Delete" Command="{Binding DeleteRuleCommand}"/>
        <KeyBinding Key="F5" Command="{Binding RefreshCommand}"/>
        <KeyBinding Key="I" Modifiers="Ctrl" Command="{Binding ImportCommand}"/>
        <KeyBinding Key="S" Modifiers="Ctrl" Command="{Binding ExportCommand}"/>
    </Window.InputBindings>
</Window>