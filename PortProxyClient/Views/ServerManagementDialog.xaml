<Window x:Class="PortProxyClient.Views.ServerManagementDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:PortProxyClient.Models"
        Title="Server Management" Height="700" Width="900"
        WindowStartupLocation="CenterOwner" ResizeMode="CanResize"
        Background="{StaticResource BackgroundBrush}"
        WindowStyle="None"
        AllowsTransparency="True">
    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="0" 
                      ResizeBorderThickness="5" 
                      CornerRadius="0"
                      GlassFrameThickness="0"/>
    </WindowChrome.WindowChrome>
    
    <Window.Resources>
        <!-- Icon Paths -->
        <Geometry x:Key="ServerIcon">M4,1H20A1,1 0 0,1 21,2V6A1,1 0 0,1 20,7H4A1,1 0 0,1 3,6V2A1,1 0 0,1 4,1M4,9H20A1,1 0 0,1 21,10V14A1,1 0 0,1 20,15H4A1,1 0 0,1 3,14V10A1,1 0 0,1 4,9M4,17H20A1,1 0 0,1 21,18V22A1,1 0 0,1 20,23H4A1,1 0 0,1 3,22V18A1,1 0 0,1 4,17M5,2V6H19V2H5M5,10V14H19V10H5M5,18V22H19V18H5Z</Geometry>
        <Geometry x:Key="SiloIcon">M12,2L13.09,8.26L22,9L13.09,9.74L12,16L10.91,9.74L2,9L10.91,8.26L12,2M12,21.5C12.83,21.5 13.5,22.17 13.5,23C13.5,23.83 12.83,24.5 12,24.5C11.17,24.5 10.5,23.83 10.5,23C10.5,22.17 11.17,21.5 12,21.5Z</Geometry>
        <Geometry x:Key="HealthIcon">M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M17,13H13V17H11V13H7V11H11V7H13V11H17V13Z</Geometry>
        <Geometry x:Key="CloseIcon">M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z</Geometry>
        <Geometry x:Key="AddIcon">M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z</Geometry>
        <Geometry x:Key="EditIcon">M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z</Geometry>
        <Geometry x:Key="DeleteIcon">M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z</Geometry>
        <Geometry x:Key="TargetIcon">M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,6A6,6 0 0,0 6,12A6,6 0 0,0 12,18A6,6 0 0,0 18,12A6,6 0 0,0 12,6M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8M12,10A2,2 0 0,0 10,12A2,2 0 0,0 12,14A2,2 0 0,0 14,12A2,2 0 0,0 12,10Z</Geometry>
        <Geometry x:Key="RefreshIcon">M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z</Geometry>
        
        <!-- Converters -->
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </Window.Resources>
    
    <Border BorderBrush="{StaticResource BorderBrush}" BorderThickness="1" Background="{StaticResource BackgroundBrush}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Custom Title Bar -->
            <Border Grid.Row="0" Background="{StaticResource SurfaceBrush}" 
                    MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid Height="32">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <TextBlock Grid.Column="0" 
                               Text="Server Management" 
                               FontSize="12"
                               VerticalAlignment="Center"
                               Margin="12,0"
                               Foreground="{StaticResource TextPrimaryBrush}"/>
                    
                    <Button Grid.Column="1" 
                            Width="46" Height="32"
                            Click="CloseButton_Click"
                            WindowChrome.IsHitTestVisibleInChrome="True">
                        <Button.Style>
                            <Style TargetType="Button" BasedOn="{StaticResource IconButton}">
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="{StaticResource ErrorBrush}"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                        <Path Data="{StaticResource CloseIcon}" 
                              Fill="{StaticResource TextSecondaryBrush}" 
                              Width="12" Height="12" 
                              Stretch="Uniform"/>
                    </Button>
                </Grid>
            </Border>

            <!-- Header -->
            <Border Grid.Row="1" Background="{StaticResource SurfaceBrush}" 
                    BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1">
                <StackPanel Margin="24,20">
                    <TextBlock Text="Server Management" 
                               FontSize="20" 
                               FontWeight="Medium" 
                               Foreground="{StaticResource TextPrimaryBrush}"/>
                    <TextBlock Text="Manage servers and silos for multi-server port forwarding" 
                               FontSize="14" 
                               Foreground="{StaticResource TextSecondaryBrush}" 
                               Margin="0,4,0,0"/>
                </StackPanel>
            </Border>

            <!-- Tab Control -->
            <TabControl Grid.Row="2" 
                        SelectedIndex="{Binding SelectedTabIndex}"
                        Background="Transparent"
                        BorderThickness="0">
                <TabControl.Style>
                    <Style TargetType="TabControl">
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="TabControl">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                        </Grid.RowDefinitions>
                                        
                                        <!-- Tab Headers -->
                                        <Border Grid.Row="0" 
                                                Background="{StaticResource SurfaceBrush}"
                                                BorderBrush="{StaticResource BorderBrush}"
                                                BorderThickness="0,0,0,1">
                                            <TabPanel x:Name="HeaderPanel" 
                                                      IsItemsHost="True" 
                                                      Background="Transparent" 
                                                      Margin="24,0"/>
                                        </Border>
                                        
                                        <!-- Tab Content -->
                                        <ContentPresenter Grid.Row="1" 
                                                          x:Name="PART_SelectedContentHost" 
                                                          ContentSource="SelectedContent"/>
                                    </Grid>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </TabControl.Style>
                
                <!-- Servers Tab -->
                <TabItem>
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal" Margin="16,12">
                            <Path Data="{StaticResource ServerIcon}" 
                                  Fill="{StaticResource PrimaryBrush}" 
                                  Width="16" Height="16" 
                                  Stretch="Uniform" 
                                  Margin="0,0,8,0"/>
                            <TextBlock Text="Agent Servers" 
                                       FontSize="14" 
                                       FontWeight="Medium"
                                       Foreground="{StaticResource TextPrimaryBrush}"/>
                        </StackPanel>
                    </TabItem.Header>
                    
                    <Grid Margin="24">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="1*"/>
                            <ColumnDefinition Width="16"/>
                            <ColumnDefinition Width="1*"/>
                        </Grid.ColumnDefinitions>
                        
                        <!-- Server List -->
                        <Border Grid.Column="0" Style="{StaticResource Card}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <Border Grid.Row="0" 
                                        Background="{StaticResource SurfaceBrush}"
                                        CornerRadius="6,6,0,0"
                                        Padding="16,12">
                                    <TextBlock Text="AGENT SERVERS" 
                                               FontSize="12" 
                                               FontWeight="SemiBold" 
                                               Foreground="{StaticResource TextSecondaryBrush}"/>
                                </Border>
                                
                                <ListBox Grid.Row="1" 
                                         ItemsSource="{Binding AgentServers}"
                                         SelectedItem="{Binding SelectedAgentServer}"
                                         Background="Transparent"
                                         BorderThickness="0"
                                         Margin="0">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <Grid Margin="16,8">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                
                                                <Ellipse Grid.Column="0" 
                                                         Width="8" Height="8" 
                                                         Fill="{Binding StatusColor}"
                                                         Margin="0,0,8,0"/>
                                                
                                                <StackPanel Grid.Column="1">
                                                    <TextBlock Text="{Binding Name}" 
                                                               FontWeight="Medium"
                                                               Foreground="{StaticResource TextPrimaryBrush}"/>
                                                    <TextBlock Text="{Binding DnsName}" 
                                                               FontSize="12"
                                                               Foreground="{StaticResource TextSecondaryBrush}"/>
                                                </StackPanel>
                                                
                                                <TextBlock Grid.Column="2" 
                                                           Text="{Binding Environment}" 
                                                           FontSize="10"
                                                           Foreground="{StaticResource TextSecondaryBrush}"
                                                           VerticalAlignment="Center"/>
                                            </Grid>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                                
                                <StackPanel Grid.Row="2" 
                                            Orientation="Horizontal" 
                                            Margin="16,8">
                                    <Button Content="New" 
                                            Style="{StaticResource SecondaryButton}"
                                            Command="{Binding NewAgentServerCommand}"
                                            Width="80" Height="45"
                                            Margin="0,0,8,0"/>
                                    <Button Style="{StaticResource IconButton}" 
                                            Command="{Binding CheckServerHealthCommand}"
                                            ToolTip="Check Health"
                                            Width="32" Height="32"
                                            Margin="0,0,4,0">
                                        <Path Data="{StaticResource HealthIcon}" 
                                              Fill="{StaticResource TextSecondaryBrush}" 
                                              Width="16" Height="16" 
                                              Stretch="Uniform"/>
                                    </Button>
                                </StackPanel>
                            </Grid>
                        </Border>
                        
                        <!-- Server Details -->
                        <Border Grid.Column="2" Style="{StaticResource Card}">
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <StackPanel>
                                    <Border Background="{StaticResource SurfaceBrush}"
                                            CornerRadius="6,6,0,0"
                                            Padding="16,12"
                                            Margin="-16,-16,-16,0">
                                        <TextBlock Text="SERVER DETAILS" 
                                                   FontSize="12" 
                                                   FontWeight="SemiBold" 
                                                   Foreground="{StaticResource TextSecondaryBrush}"/>
                                    </Border>
                                    
                                    <StackPanel Margin="0,16,0,0">
                                        <!-- Agent Server Name -->
                                        <StackPanel Margin="0,0,0,16">
                                            <Label Content="Agent Server Name" Style="{StaticResource ModernLabel}"/>
                                            <TextBox Style="{StaticResource ModernTextBox}"
                                                     Text="{Binding EditingAgentServer.Name, UpdateSourceTrigger=PropertyChanged}"/>
                                        </StackPanel>
                                        
                                        <!-- Agent URL -->
                                        <StackPanel Margin="0,0,0,16">
                                            <Label Content="Agent URL (HTTP endpoint)" Style="{StaticResource ModernLabel}"/>
                                            <TextBox Style="{StaticResource ModernTextBox}"
                                                     Text="{Binding EditingAgentServer.AgentUrl, UpdateSourceTrigger=PropertyChanged}"
                                                     ToolTip="Example: http://server.domain.com:8080"/>
                                        </StackPanel>
                                        
                                        <!-- Secret Key -->
                                        <StackPanel Margin="0,0,0,16">
                                            <Label Content="Secret Key (for encryption)" Style="{StaticResource ModernLabel}"/>
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBox Grid.Column="0" Style="{StaticResource ModernTextBox}"
                                                         Text="{Binding EditingAgentServer.SecretKey, UpdateSourceTrigger=PropertyChanged}"/>
                                                <Button Grid.Column="1" Content="Generate" 
                                                        Style="{StaticResource SecondaryButton}" 
                                                        Command="{Binding GenerateSecretKeyCommand}"
                                                        Width="100" Height="45" Margin="8,0,0,0"/>
                                            </Grid>
                                        </StackPanel>
                                        
                                        <!-- Environment -->
                                        <StackPanel Margin="0,0,0,16">
                                            <Label Content="Environment" Style="{StaticResource ModernLabel}"/>
                                            <ComboBox Style="{StaticResource ModernComboBox}"
                                                      ItemsSource="{Binding AvailableEnvironments}"
                                                      SelectedItem="{Binding EditingAgentServer.Environment}"/>
                                        </StackPanel>
                                        
                                        <!-- Silo Assignment -->
                                        <StackPanel Margin="0,0,0,16">
                                            <Label Content="Silo Assignment" Style="{StaticResource ModernLabel}"/>
                                            <ComboBox Style="{StaticResource ModernComboBox}"
                                                      ItemsSource="{Binding Silos}"
                                                      SelectedValue="{Binding EditingAgentServer.SiloId}"
                                                      SelectedValuePath="Id">
                                                <ComboBox.ItemTemplate>
                                                    <DataTemplate>
                                                        <StackPanel Orientation="Horizontal">
                                                            <TextBlock Text="{Binding Name}" 
                                                                       Margin="0,0,8,0"/>
                                                            <TextBlock Text="{Binding RoleText}" 
                                                                       FontSize="10"
                                                                       Foreground="{Binding RoleColor}"/>
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </ComboBox.ItemTemplate>
                                            </ComboBox>
                                        </StackPanel>
                                        
                                        <!-- Description -->
                                        <StackPanel Margin="0,0,0,16">
                                            <Label Content="Description" Style="{StaticResource ModernLabel}"/>
                                            <TextBox Style="{StaticResource ModernTextBox}"
                                                     Text="{Binding EditingAgentServer.Description, UpdateSourceTrigger=PropertyChanged}"
                                                     AcceptsReturn="True"
                                                     Height="60"
                                                     VerticalScrollBarVisibility="Auto"/>
                                        </StackPanel>
                                        
                                        <!-- Actions -->
                                        <StackPanel Orientation="Horizontal" 
                                                    Margin="0,16,0,0">
                                            <Button Content="Save" 
                                                    Style="{StaticResource ModernButton}"
                                                    Command="{Binding SaveAgentServerCommand}"
                                                    Width="120" Height="45"
                                                    Margin="0,0,8,0"/>
                                            <Button Content="Delete" 
                                                    Style="{StaticResource SecondaryButton}"
                                                    Command="{Binding DeleteAgentServerCommand}"
                                                    Width="120" Height="45"
                                                    Margin="0,0,8,0"/>
                                            <Button Content="Test Connection" 
                                                    Style="{StaticResource SecondaryButton}"
                                                    Command="{Binding TestAgentConnectionCommand}"
                                                    Width="180" Height="45"/>
                                        </StackPanel>
                                        
                                        <!-- Failover Actions -->
                                        <StackPanel Orientation="Horizontal" 
                                                    Margin="0,8,0,0">
                                            <Button Content="Configure Failover" 
                                                    Style="{StaticResource SecondaryButton}"
                                                    Command="{Binding ConfigureFailoverCommand}"
                                                    Width="200" Height="45"
                                                    Margin="0,0,8,0"/>
                                        </StackPanel>
                                        
                                        <!-- Validation Message -->
                                        <Border Visibility="{Binding AgentServerValidationMessage, Converter={StaticResource BooleanToVisibilityConverter}}" 
                                                Background="#FFEBEE" 
                                                CornerRadius="6" 
                                                Padding="12" 
                                                Margin="0,16,0,0">
                                            <TextBlock Text="{Binding AgentServerValidationMessage}"
                                                       Foreground="{StaticResource ErrorBrush}"
                                                       TextWrapping="Wrap"
                                                       FontSize="13"/>
                                        </Border>
                                    </StackPanel>
                                </StackPanel>
                            </ScrollViewer>
                        </Border>
                    </Grid>
                </TabItem>
                
                <!-- Silos Tab -->
                <TabItem>
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal" Margin="16,12">
                            <Path Data="{StaticResource SiloIcon}" 
                                  Fill="{StaticResource PrimaryBrush}" 
                                  Width="16" Height="16" 
                                  Stretch="Uniform" 
                                  Margin="0,0,8,0"/>
                            <TextBlock Text="Silos" 
                                       FontSize="14" 
                                       FontWeight="Medium"
                                       Foreground="{StaticResource TextPrimaryBrush}"/>
                        </StackPanel>
                    </TabItem.Header>
                    
                    <Grid Margin="24">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="1*"/>
                            <ColumnDefinition Width="16"/>
                            <ColumnDefinition Width="1*"/>
                        </Grid.ColumnDefinitions>
                        
                        <!-- Silo List -->
                        <Border Grid.Column="0" Style="{StaticResource Card}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <Border Grid.Row="0" 
                                        Background="{StaticResource SurfaceBrush}"
                                        CornerRadius="6,6,0,0"
                                        Padding="16,12">
                                    <TextBlock Text="SILOS" 
                                               FontSize="12" 
                                               FontWeight="SemiBold" 
                                               Foreground="{StaticResource TextSecondaryBrush}"/>
                                </Border>
                                
                                <ListBox Grid.Row="1" 
                                         ItemsSource="{Binding Silos}"
                                         SelectedItem="{Binding SelectedSilo}"
                                         Background="Transparent"
                                         BorderThickness="0">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <Grid Margin="16,8">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                
                                                <Ellipse Grid.Column="0" 
                                                         Width="8" Height="8" 
                                                         Fill="{Binding StatusColor}"
                                                         Margin="0,0,8,0"/>
                                                
                                                <StackPanel Grid.Column="1">
                                                    <TextBlock Text="{Binding Name}" 
                                                               FontWeight="Medium"
                                                               Foreground="{StaticResource TextPrimaryBrush}"/>
                                                    <TextBlock Text="{Binding HealthText}" 
                                                               FontSize="12"
                                                               Foreground="{StaticResource TextSecondaryBrush}"/>
                                                </StackPanel>
                                                
                                                <Border Grid.Column="2" 
                                                        Background="{Binding RoleColor}"
                                                        CornerRadius="3"
                                                        Padding="6,2">
                                                    <TextBlock Text="{Binding RoleText}" 
                                                               FontSize="10"
                                                               FontWeight="SemiBold"
                                                               Foreground="White"/>
                                                </Border>
                                            </Grid>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                                
                                <StackPanel Grid.Row="2" 
                                            Orientation="Horizontal" 
                                            Margin="16,8">
                                    <Button Content="New" 
                                            Style="{StaticResource SecondaryButton}"
                                            Command="{Binding NewSiloCommand}"
                                            Width="80" Height="45"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                        
                        <!-- Silo Details -->
                        <Border Grid.Column="2" Style="{StaticResource Card}">
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <StackPanel>
                                    <Border Background="{StaticResource SurfaceBrush}"
                                            CornerRadius="6,6,0,0"
                                            Padding="16,12"
                                            Margin="-16,-16,-16,0">
                                        <TextBlock Text="SILO DETAILS" 
                                                   FontSize="12" 
                                                   FontWeight="SemiBold" 
                                                   Foreground="{StaticResource TextSecondaryBrush}"/>
                                    </Border>
                                    
                                    <StackPanel Margin="0,16,0,0">
                                        <!-- Silo Name -->
                                        <StackPanel Margin="0,0,0,16">
                                            <Label Content="Silo Name" Style="{StaticResource ModernLabel}"/>
                                            <TextBox Style="{StaticResource ModernTextBox}"
                                                     Text="{Binding EditingSilo.Name, UpdateSourceTrigger=PropertyChanged}"/>
                                        </StackPanel>
                                        
                                        <!-- Role -->
                                        <StackPanel Margin="0,0,0,16">
                                            <Label Content="Role" Style="{StaticResource ModernLabel}"/>
                                            <ComboBox Style="{StaticResource ModernComboBox}"
                                                      ItemsSource="{Binding AvailableRoles}"
                                                      SelectedItem="{Binding EditingSilo.Role}"/>
                                        </StackPanel>
                                        
                                        <!-- Data Center -->
                                        <StackPanel Margin="0,0,0,16">
                                            <Label Content="Data Center" Style="{StaticResource ModernLabel}"/>
                                            <TextBox Style="{StaticResource ModernTextBox}"
                                                     Text="{Binding EditingSilo.DataCenter, UpdateSourceTrigger=PropertyChanged}"/>
                                        </StackPanel>
                                        
                                        <!-- Description -->
                                        <StackPanel Margin="0,0,0,16">
                                            <Label Content="Description" Style="{StaticResource ModernLabel}"/>
                                            <TextBox Style="{StaticResource ModernTextBox}"
                                                     Text="{Binding EditingSilo.Description, UpdateSourceTrigger=PropertyChanged}"
                                                     AcceptsReturn="True"
                                                     Height="60"
                                                     VerticalScrollBarVisibility="Auto"/>
                                        </StackPanel>
                                        
                                        <!-- Actions -->
                                        <StackPanel Orientation="Horizontal" 
                                                    Margin="0,16,0,0">
                                            <Button Content="Save" 
                                                    Style="{StaticResource ModernButton}"
                                                    Command="{Binding SaveSiloCommand}"
                                                    Width="120" Height="45"
                                                    Margin="0,0,8,0"/>
                                            <Button Content="Delete" 
                                                    Style="{StaticResource SecondaryButton}"
                                                    Command="{Binding DeleteSiloCommand}"
                                                    Width="120" Height="45"/>
                                        </StackPanel>
                                        
                                        <!-- Validation Message -->
                                        <Border Visibility="{Binding SiloValidationMessage, Converter={StaticResource BooleanToVisibilityConverter}}" 
                                                Background="#FFEBEE" 
                                                CornerRadius="6" 
                                                Padding="12" 
                                                Margin="0,16,0,0">
                                            <TextBlock Text="{Binding SiloValidationMessage}"
                                                       Foreground="{StaticResource ErrorBrush}"
                                                       TextWrapping="Wrap"
                                                       FontSize="13"/>
                                        </Border>
                                    </StackPanel>
                                </StackPanel>
                            </ScrollViewer>
                        </Border>
                    </Grid>
                </TabItem>
                
                <!-- Target Servers Tab -->
                <TabItem>
                    <TabItem.Header>
                        <StackPanel Orientation="Horizontal" Margin="16,12">
                            <Path Data="{StaticResource TargetIcon}" 
                                  Fill="{StaticResource PrimaryBrush}" 
                                  Width="16" Height="16" 
                                  Stretch="Uniform" 
                                  Margin="0,0,8,0"/>
                            <TextBlock Text="Target Servers" 
                                       FontSize="14" 
                                       FontWeight="Medium"
                                       Foreground="{StaticResource TextPrimaryBrush}"/>
                        </StackPanel>
                    </TabItem.Header>
                    
                    <Grid Margin="24">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="1*"/>
                            <ColumnDefinition Width="16"/>
                            <ColumnDefinition Width="1*"/>
                        </Grid.ColumnDefinitions>
                        
                        <!-- Target Server List -->
                        <Border Grid.Column="0" Style="{StaticResource Card}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <Border Grid.Row="0" 
                                        Background="{StaticResource SurfaceBrush}"
                                        CornerRadius="6,6,0,0"
                                        Padding="16,12">
                                    <TextBlock Text="TARGET SERVERS" 
                                               FontSize="12" 
                                               FontWeight="SemiBold" 
                                               Foreground="{StaticResource TextSecondaryBrush}"/>
                                </Border>
                                
                                <ListBox Grid.Row="1" 
                                         ItemsSource="{Binding TargetServers}"
                                         SelectedItem="{Binding SelectedTargetServer}"
                                         Background="Transparent"
                                         BorderThickness="0"
                                         Margin="0">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <Grid Margin="16,8">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                
                                                <Ellipse Grid.Column="0" 
                                                         Width="8" Height="8" 
                                                         Fill="{Binding DnsStatusColor}"
                                                         Margin="0,0,8,0"/>
                                                
                                                <StackPanel Grid.Column="1">
                                                    <TextBlock Text="{Binding Name}" 
                                                               FontWeight="Medium"
                                                               Foreground="{StaticResource TextPrimaryBrush}"/>
                                                    <TextBlock Text="{Binding DnsName}" 
                                                               FontSize="12"
                                                               Foreground="{StaticResource TextSecondaryBrush}"/>
                                                </StackPanel>
                                                
                                                <TextBlock Grid.Column="2" 
                                                           Text="{Binding Environment}" 
                                                           FontSize="10"
                                                           Foreground="{StaticResource TextSecondaryBrush}"
                                                           VerticalAlignment="Center"/>
                                            </Grid>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                                
                                <StackPanel Grid.Row="2" 
                                            Orientation="Horizontal" 
                                            Margin="16,8">
                                    <Button Content="New" 
                                            Style="{StaticResource SecondaryButton}"
                                            Command="{Binding NewTargetServerCommand}"
                                            Width="80" Height="45"
                                            Margin="0,0,8,0"/>
                                    <Button Style="{StaticResource IconButton}" 
                                            Command="{Binding ResolveDnsCommand}"
                                            ToolTip="Resolve DNS"
                                            Width="32" Height="32"
                                            Margin="0,0,4,0">
                                        <Path Data="{StaticResource RefreshIcon}" 
                                              Fill="{StaticResource TextSecondaryBrush}" 
                                              Width="16" Height="16" 
                                              Stretch="Uniform"/>
                                    </Button>
                                </StackPanel>
                            </Grid>
                        </Border>
                        
                        <!-- Target Server Details -->
                        <Border Grid.Column="2" Style="{StaticResource Card}">
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <StackPanel>
                                    <Border Background="{StaticResource SurfaceBrush}"
                                            CornerRadius="6,6,0,0"
                                            Padding="16,12"
                                            Margin="-16,-16,-16,0">
                                        <TextBlock Text="TARGET SERVER DETAILS" 
                                                   FontSize="12" 
                                                   FontWeight="SemiBold" 
                                                   Foreground="{StaticResource TextSecondaryBrush}"/>
                                    </Border>
                                    
                                    <StackPanel Margin="0,16,0,0">
                                        <!-- Target Server Name -->
                                        <StackPanel Margin="0,0,0,16">
                                            <Label Content="Target Server Name" Style="{StaticResource ModernLabel}"/>
                                            <TextBox Style="{StaticResource ModernTextBox}"
                                                     Text="{Binding EditingTargetServer.Name, UpdateSourceTrigger=PropertyChanged}"/>
                                        </StackPanel>
                                        
                                        <!-- DNS Name -->
                                        <StackPanel Margin="0,0,0,16">
                                            <Label Content="DNS Name / IP Address" Style="{StaticResource ModernLabel}"/>
                                            <TextBox Style="{StaticResource ModernTextBox}"
                                                     Text="{Binding EditingTargetServer.DnsName, UpdateSourceTrigger=PropertyChanged}"
                                                     ToolTip="Example: server.domain.com or 192.168.1.100"/>
                                        </StackPanel>
                                        
                                        <!-- Resolved IP (Read-only) -->
                                        <StackPanel Margin="0,0,0,16">
                                            <Label Content="Resolved IP Address" Style="{StaticResource ModernLabel}"/>
                                            <TextBox Style="{StaticResource ModernTextBox}"
                                                     Text="{Binding EditingTargetServer.IpAddress}"
                                                     IsReadOnly="True"
                                                     Background="{StaticResource SurfaceBrush}"/>
                                        </StackPanel>
                                        
                                        <!-- Environment -->
                                        <StackPanel Margin="0,0,0,16">
                                            <Label Content="Environment" Style="{StaticResource ModernLabel}"/>
                                            <ComboBox Style="{StaticResource ModernComboBox}"
                                                      ItemsSource="{Binding AvailableEnvironments}"
                                                      SelectedItem="{Binding EditingTargetServer.Environment}"/>
                                        </StackPanel>
                                        
                                        <!-- Description -->
                                        <StackPanel Margin="0,0,0,16">
                                            <Label Content="Description" Style="{StaticResource ModernLabel}"/>
                                            <TextBox Style="{StaticResource ModernTextBox}"
                                                     Text="{Binding EditingTargetServer.Description, UpdateSourceTrigger=PropertyChanged}"
                                                     AcceptsReturn="True"
                                                     Height="60"
                                                     VerticalScrollBarVisibility="Auto"/>
                                        </StackPanel>
                                        
                                        <!-- Failover Pairing -->
                                        <StackPanel Margin="0,0,0,16">
                                            <Label Content="Failover Pair" Style="{StaticResource ModernLabel}"/>
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <ComboBox Grid.Column="0" 
                                                          Style="{StaticResource ModernComboBox}"
                                                          ItemsSource="{Binding AvailableTargetServersForPairing}"
                                                          SelectedItem="{Binding SelectedPairTargetServer}"
                                                          ToolTip="Select a target server to create a failover pair">
                                                    <ComboBox.ItemTemplate>
                                                        <DataTemplate>
                                                            <StackPanel Orientation="Horizontal">
                                                                <TextBlock Text="{Binding Name}" Margin="0,0,8,0"/>
                                                                <TextBlock Text="{Binding DnsName}" 
                                                                           FontSize="10"
                                                                           Foreground="{StaticResource TextSecondaryBrush}"
                                                                           Margin="0,0,8,0"/>
                                                                <TextBlock Text="{Binding PairingStatus}" 
                                                                           FontSize="10"
                                                                           FontStyle="Italic"
                                                                           Foreground="{StaticResource PrimaryBrush}"/>
                                                            </StackPanel>
                                                        </DataTemplate>
                                                    </ComboBox.ItemTemplate>
                                                </ComboBox>
                                                <Button Grid.Column="1" 
                                                        Content="{Binding PairButtonText}" 
                                                        Style="{StaticResource SecondaryButton}"
                                                        Command="{Binding CreateFailoverPairCommand}"
                                                        Width="100" Height="45" 
                                                        Margin="8,0,0,0"/>
                                            </Grid>
                                        </StackPanel>
                                        
                                        <!-- Actions -->
                                        <StackPanel Orientation="Horizontal" 
                                                    Margin="0,16,0,0">
                                            <Button Content="Save" 
                                                    Style="{StaticResource ModernButton}"
                                                    Command="{Binding SaveTargetServerCommand}"
                                                    Width="120" Height="45"
                                                    Margin="0,0,8,0"/>
                                            <Button Content="Delete" 
                                                    Style="{StaticResource SecondaryButton}"
                                                    Command="{Binding DeleteTargetServerCommand}"
                                                    Width="120" Height="45"/>
                                        </StackPanel>
                                        
                                        <!-- Validation Message -->
                                        <Border Visibility="{Binding TargetServerValidationMessage, Converter={StaticResource BooleanToVisibilityConverter}}" 
                                                Background="#FFEBEE" 
                                                CornerRadius="6" 
                                                Padding="12" 
                                                Margin="0,16,0,0">
                                            <TextBlock Text="{Binding TargetServerValidationMessage}"
                                                       Foreground="{StaticResource ErrorBrush}"
                                                       TextWrapping="Wrap"
                                                       FontSize="13"/>
                                        </Border>
                                    </StackPanel>
                                </StackPanel>
                            </ScrollViewer>
                        </Border>
                    </Grid>
                </TabItem>
            </TabControl>

            <!-- Status Bar -->
            <Border Grid.Row="3" 
                    Background="{StaticResource SurfaceBrush}" 
                    BorderBrush="{StaticResource BorderBrush}" 
                    BorderThickness="0,1,0,0">
                <Grid Margin="24,12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <TextBlock Grid.Column="0" 
                               Text="{Binding StatusText}" 
                               FontSize="12" 
                               Foreground="{StaticResource TextSecondaryBrush}" 
                               VerticalAlignment="Center"/>
                    
                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                        <Button Content="Export" 
                                Style="{StaticResource SecondaryButton}" 
                                Command="{Binding ExportConfigCommand}"
                                Width="80" Height="45"
                                Margin="0,0,8,0"/>
                        <Button Content="Import" 
                                Style="{StaticResource SecondaryButton}" 
                                Command="{Binding ImportConfigCommand}"
                                Width="80" Height="45"
                                Margin="0,0,16,0"/>
                        <Button Content="Close" 
                                Style="{StaticResource ModernButton}" 
                                Click="CloseButton_Click"
                                Width="80" Height="45"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>